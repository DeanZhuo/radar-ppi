cmake_minimum_required(VERSION 3.10)
project(radar_test_app)

set(CMAKE_CXX_STANDARD 11)

add_executable(radar_test_app
    src/main.cpp
)

target_link_libraries(radar_test_app
    PRIVATE radar_core radar_opengl
)

target_include_directories(radar_test_app
    PRIVATE ${CMAKE_SOURCE_DIR}/core/include
            ${CMAKE_SOURCE_DIR}/opengl/include
)

if (MINGW)
  # Get the path to the executable's output directory
  get_target_property(OUTPUT_DIR radar_test_app RUNTIME_OUTPUT_DIRECTORY)

  # Find the DLLs
  # For freeglut
  find_file(FREEGLUT_DLL libfreeglut.dll HINTS ${GLUT} PATH_SUFFIXES bin)
  # For GLEW
  find_file(GLEW_DLL glew32.dll HINTS ${GLEW} PATH_SUFFIXES bin)
  # For libstdc++-6.dll from MinGW
  find_file(STDCPP_DLL libstdc++-6.dll HINTS ${CMAKE_CXX_COMPILER} PATH_SUFFIXES ../bin)
  # For libgcc_s_seh-1.dll from MinGW
  find_file(GCC_S_SEH_DLL libgcc_s_seh-1.dll HINTS ${CMAKE_CXX_COMPILER} PATH_SUFFIXES ../bin)
  # For libwinpthread-1.dll from MinGW
  find_file(WIN_PTHREAD_DLL libwinpthread-1.dll HINTS ${CMAKE_CXX_COMPILER} PATH_SUFFIXES ../bin)

  # Add a custom command to copy the DLLs after the build
  if(FREEGLUT_DLL AND GLEW_DLL AND STDCPP_DLL AND GCC_S_SEH_DLL AND WIN_PTHREAD_DLL)
    add_custom_command(
      TARGET radar_test_app POST_BUILD
      COMMAND ${CMAKE_COMMAND} -E copy
      ${FREEGLUT_DLL}
      ${OUTPUT_DIR}
      COMMENT "Copying freeglut dll"
    )
    add_custom_command(
      TARGET radar_test_app POST_BUILD
      COMMAND ${CMAKE_COMMAND} -E copy
      ${GLEW_DLL}
      ${OUTPUT_DIR}
      COMMENT "Copying glew32 dll"
    )
    add_custom_command(
      TARGET radar_test_app POST_BUILD
      COMMAND ${CMAKE_COMMAND} -E copy
      ${STDCPP_DLL}
      ${OUTPUT_DIR}
      COMMENT "Copying libstdc++ dll"
    )
    add_custom_command(
      TARGET radar_test_app POST_BUILD
      COMMAND ${CMAKE_COMMAND} -E copy
      ${GCC_S_SEH_DLL}
      ${OUTPUT_DIR}
      COMMENT "Copying libwinpthread dll"
    )
    add_custom_command(
      TARGET radar_test_app POST_BUILD
      COMMAND ${CMAKE_COMMAND} -E copy
      ${WIN_PTHREAD_DLL}
      ${OUTPUT_DIR}
      COMMENT "Copying libgcc_s_seh dll"
      )
  else()
    message("One of the runtimes dll not found")
  endif()
endif()